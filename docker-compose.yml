version: '3.8'

services:
  # 1. Web Server (PHP + Apache)
  web:
    build: .
    container_name: klinik_web
    ports:
      - "8080:80"  # Akses web di http://localhost:8080
    volumes:
      - ./src/:/var/www/html/ # "Mount" kode Anda dari folder 'src' ke server
    depends_on:
      - db # Web server baru nyala setelah database siap

  # 2. Database (MySQL)
  db:
    image: mysql:8.0
    container_name: klinik_db
    restart: always
    environment:
      MYSQL_DATABASE: klinik_hewan  # Nama database (sesuai skema Anda)
      MYSQL_USER: user
      MYSQL_PASSWORD: password
      MYSQL_ROOT_PASSWORD: root_password
    volumes:
      - db_data:/var/lib/mysql # Menyimpan data database secara permanen

  # 3. phpMyAdmin (Untuk manajemen database)
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: klinik_pma
    ports:
      - "8081:80" # Akses phpMyAdmin di http://localhost:8081
    environment:
      PMA_HOST: db      # Menghubungkan ke service 'db' di atas
      PMA_PORT: 3306
    depends_on:
      - db

  nginx:
    image: nginx:stable-alpine
    container_name: klinik_nginx
    ports:
      # Nginx akan mengambil alih port 80 (HTTP)
      - "80:80" 
      # Tambahkan port 443 (HTTPS) untuk SSL nanti
      - "443:443" 
    volumes:
      # Mount file konfigurasi Nginx yang baru kita buat
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - web # Nginx baru berjalan setelah web container siap

volumes:
  db_data: # Definisi volume untuk 'db'